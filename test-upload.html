<!DOCTYPE html>
<html>
<head>
    <title>Teste Upload VIP Content</title>
</head>
<body>
    <h2>Teste de Upload - Conteúdo VIP</h2>
    
    <form id="uploadForm">
        <div>
            <label for="title">Título:</label>
            <input type="text" id="title" name="title" value="Teste Upload" required>
        </div>
        <br>
        
        <div>
            <label for="description">Descrição:</label>
            <textarea id="description" name="description">Teste de upload via formulário</textarea>
        </div>
        <br>
        
        <div>
            <label for="type">Tipo:</label>
            <select id="type" name="type">
                <option value="photo">Foto</option>
                <option value="video">Vídeo</option>
            </select>
        </div>
        <br>
        
        <div>
            <label for="file">Arquivo:</label>
            <input type="file" id="file" name="file" accept="image/*,video/*">
        </div>
        <br>
        
        <button type="submit">Fazer Upload</button>
    </form>
    
    <div id="result"></div>
    
    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Fazendo upload...';
            
            const file = document.getElementById('file').files[0];
            if (!file) {
                resultDiv.innerHTML = 'Por favor selecione um arquivo';
                return;
            }
            
            try {
                // Primeiro, fazer upload do arquivo
                const formData = new FormData();
                formData.append('file', file);
                formData.append('folder', 'vip-content');
                
                console.log('Enviando arquivo:', file.name, file.type, file.size);
                
                const uploadResponse = await fetch('/api/admin/upload', {
                    method: 'POST',
                    body: formData,
                });
                
                const uploadData = await uploadResponse.json();
                console.log('Resposta do upload:', uploadData);
                
                if (!uploadData.success) {
                    throw new Error(uploadData.message || 'Erro no upload');
                }
                
                // Agora criar o conteúdo VIP
                const contentData = {
                    title: document.getElementById('title').value,
                    description: document.getElementById('description').value,
                    type: document.getElementById('type').value,
                    url: uploadData.url,
                    thumbnailUrl: '',
                    tags: []
                };
                
                console.log('Criando conteúdo VIP:', contentData);
                
                const contentResponse = await fetch('/api/admin/vip-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(contentData),
                });
                
                const contentResult = await contentResponse.json();
                console.log('Resposta do conteúdo:', contentResult);
                
                if (contentResult.success) {
                    resultDiv.innerHTML = `
                        <div style="color: green;">
                            <h3>Upload realizado com sucesso!</h3>
                            <p><strong>URL do arquivo:</strong> ${uploadData.url}</p>
                            <p><strong>ID do conteúdo:</strong> ${contentResult.id}</p>
                        </div>
                    `;
                } else {
                    throw new Error(contentResult.message || 'Erro ao criar conteúdo');
                }
                
            } catch (error) {
                console.error('Erro:', error);
                resultDiv.innerHTML = `<div style="color: red;">Erro: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
